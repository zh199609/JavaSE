###### JVM参数：

```
-XX:+HeapDumpOnOutOfMemoryError			堆溢出时打印堆存储快照
-Xms20m	jvm初始内存
-Xmx3g	jvm最大内存		讲-Xms和-Xmx设置相同，避免Jvm垃圾回收后重新分配内存
-Xmn1g	年轻代Sun官方推荐配置为整个堆得3/8
-XX:NewRatio=4	调整年轻代与老年代比例（年轻代：老年代=1：4）
-XX:MaxTenuringThreshold=0
	设置晋升到老年代的对象年龄，如果设置为0，则年轻代对象不经过Survivor区，直接进入老年代。如果将此值设置为一个较大值，则年轻代对象会在Survivor区进行多次复制。
-verbose:gc	打印gc信息 
-XX:+PrintGCDetail	GC详细信息
-XX:+PretenureSizeThreshould=6M	大对象直接进入到老年代 
-XX:+HandlePromotionFailure   空间分配担保
 
```

Jconsole	java内存监控可视化	cmd窗口运行

jvisualvm	监控可视化工具		cmd

![](/images/JVM内存图.jpg)



###### 程序计数器

​	较小的内存空间，他可以看作是当前线程所执行的字节码的行号指示器

###### 虚拟机栈

​	描述的是Java方法执行的动态内存模型

​	栈帧：每个方法执行，都会创建一个栈帧，伴随着方法从创建到执行完成。用于存储局部变量表，操作数栈，动态链接，方法出口等。

​	局部变量表：存放编译期可知的各种基本数据类型，引用类型。局部变量表的内存空间在编译期完成分配，当进入一个方法时，这个方法需要在帧分配多少内存是固定的，在方法运行期间是不会改变局部变量表的大小

​	StackOverflowError

​	OutOfMemory

###### 本地方法栈

###### Java堆

​	存放实例对象，垃圾收集器管理的主要区域，新生代，老年代

###### 方法区

​	存储运行时常量池，已被虚拟机加载的类信息，常量，静态变量，即时编译器编译后的代码等数据

​	

###### 对象的结构

​	Header(对象头)：自身运行时的数据（哈希值，GC分代年龄，锁状态，线程持有的锁，偏向线程ID等） ，类型指针

​	InstanceData

​	Padding:填充 

###### 对象的创建： 

​	给对象分配内存（指正碰撞、空闲列表）

​	线程安全性问题（线程同步，本地线程分配缓冲TLAB）

​	初始化对象

​	执行构造方法

​	new类名--》根据new的参数在常量池中定位一个类的符号引用--》如果没有找到这个符号引用，说明类还没有被加载，则进行类的加载、解析和初始化--》虚拟机为对象分配内存（堆）--》讲分配的内存初始化为零值（不包括对象头）--》条用对象的<init>方法

###### 对象的访问定位：

​	使用句柄，直接地址

###### 垃圾回收

​	如何判定对象为垃圾对象：引用计数法，可达性分析

​	如何回收：标记-清除，复制算法，标记-整理，分代回收

​	垃圾回收器：Serial，Parnew,Cms

​	NIO中的直接内操作系统控制



###### 引用计数算法

​	在对象中添加一个引用计数器，当有地方引用这个对象的时候，引用计算器+1

###### 可达性分析算法

​	GCRoot:作为GCRoot的对象，虚拟机栈	方法区的类属性所引用的对象	方法区中常量所引用的对象	本地方法栈中引用的对象

###### 标记清除算法

###### 复制算法

​	堆 

​		新生代	Eden  Survivor	Tenured Gen

​		老年代

​	方法区

###### 标记整理算法

###### Serial收集器

​	单线程的垃圾收集器

###### ParNew收集器

###### Parallel Scavenge收集器

​	复制算法（新生代收集器）

​	多线程收集器

​	达到可控制的吞吐量

​	-XX:MaxGFPauseMillis 垃圾收集器停顿时间

​	-XX:GCTimeTatio 吞吐量大小  吞吐量=CPU用于运行代码的时间/CPU消耗的总时间

###### CMS收集器 Concurrent Mark Sweep

​	工作过程：

​		初始标记》并发标记》重新标记》并发清理

​	优点：

​		并发收集、低停顿

​	缺点：

​		占用大量的CPU资源、无法处理浮动垃圾、出现Concurrent Mode Failure、空间碎片

###### G1收集器

​	优势：

​		并行与并发、分代收集、空间整合、可预测的停顿

​	步骤：

​		初始标记、并发标记、最终标记、筛选回收

  



##### 内存分配

​	优先分配到Eden，大对象直接分配到老年代，长期存活的对象分配到老年代，空间分配担保

​	动态对象年龄判断

###### 逃逸分析与栈上分配

​	逃逸分析：分析对象的作用域



##### 工具

###### JPS

​	JPS -m  运行时传入主类的参数

​	jps -v	虚拟机参数

​	jps -l	运行主类全名			jps -mlv  显示全部信息

###### Jstat

​	类装载

###### jinfo

​	实时查看和调整虚拟机的各项参数

###### jstack

​	线程快照 





















Hadoop

Lucene

Jbpm